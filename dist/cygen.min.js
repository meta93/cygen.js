/*! Cygen.js - v1.1.0 - 2018-01-23
* https://github.com/iongraphix/Cygen.js
* Copyright (c) 2018 Damoah Dominic; Licensed  */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):a.Cygen=b()}(this,function(){"use strict";function a(){const a="incoming",b="outgoing",c="normal",d="single";var e=null,f=[],g=!0;this.version=function(){return"Version: 1.1.0"},this.show_version=function(){console.info(this.version())},this.find_isolated_nodes=function(a){for(var b=a.nodes,c=a.links,d=[],e=0;e<b.length;e++){for(var f=!1,g=0;g<c.length;g++)(b[e].id==c[g].source.id||b[e].id==c[g].target.id)&&(f=!0);f||d.push(b[e])}return d},this.generate_random_query_graph=function(a){function b(a,b){g[a][b]=g[b][a]=!0}var c,d,e,f=[],g=[];for(c=0;c<a.order;c+=1)g[c]=[],f.push({id:c});var h=[];if(c=0,a.connected){for(c=1;c<a.order;c+=1)e=Math.floor(Math.random()*c),b(c,e),h.push({source:c,target:e});c-=1}for(;c<a.size;c+=1)d=Math.floor(Math.random()*a.order),e=Math.floor(Math.random()*a.order),d!==e||a.pseudoGraph?g[d][e]&&!a.multiGraph?c-=1:(b(d,e),h.push({source:d,target:e})):c-=1;return{nodes:f,links:h}},this.is_graph_flagged=function(a){for(var b=0,c=0;c<a.links.length;c++)a.links[c].flagged&&b++;return 0==b?!1:b==a.links.length?!0:!1},this.generate_chains=function(a){var b={incoming:[],outgoing:[]};if(this.is_graph_flagged(a)||0==a.links.length)return b;for(var c=a.nodes.length,d=0;c>d;d++){for(var e=0,f=0,g=a.nodes[d].id,h=a.links.length-1;h>=0;h--)a.links[h].flagged||(g==a.links[h].source.id?f++:g==a.links[h].target.id&&e++);b.incoming.push({node:g,count:e}),b.outgoing.push({node:g,count:f})}return b},this.prune_tgraph=function(a){for(var b=0;b<a.length;b++)e.links[a[b]].flagged=!0},this.generate_fragment=function(g,h){var i=[],j=[];if(g==d){for(var k=0;k<e.links.length;k++)if(!e.links[k].flagged){var l=this.generate_single(e.links[k]);i.push(k),f.push(l)}this.prune_tgraph(i)}else if(g==c)if(h.param.chain==a){var m=h.param.related_links;if(m.length%2==0){for(var k=0;k<m.length;k+=2)if(!m[k].flagged&&!m[k+1].flagged){var l=this.generate_double([m[k],m[k+1]],a);j.push(m[k].id),j.push(m[k+1].id),f.push(l)}}else{var n=m[m.length-1].flagged?null:m[m.length-1];j.push(m[m.length-1].id);for(var o=this.generate_single(n),k=0;k<m.length-1;k+=2)if(!m[k].flagged&&!m[k+1].flagged){var l=this.generate_double([m[k],m[k+1]],a);j.push(m[k].id),j.push(m[k+1].id),f.push(l)}f.push(o)}this.prune_links(j)}else if(h.param.chain==b){var m=h.param.related_links;if(m.length%2==0){for(var k=0;k<m.length;k+=2)if(!m[k].flagged&&!m[k+1].flagged){var l=this.generate_double([m[k],m[k+1]],b);j.push(m[k].id),j.push(m[k+1].id),f.push(l)}}else{var n=m[m.length-1].flagged?null:m[m.length-1];j.push(m[m.length-1].id);for(var o=this.generate_single(n),k=0;k<m.length-1;k+=2)if(!m[k].flagged&&!m[k+1].flagged){var l=this.generate_double([m[k],m[k+1]],b);j.push(m[k].id),j.push(m[k+1].id),f.push(l)}f.push(o)}this.prune_links(j)}},this.generate_node_frags=function(a){for(var b=0;b<a.length;b++)f.push("("+a[b].id+")")},this.generate_single=function(a){return null==a?"NULL SET":a.directed?"(n"+a.source.id+")-[:NOLABEL]->(n"+a.target.id+")":"(n"+a.source.id+")-[:NOLABEL]-(n"+a.target.id+")"},this.generate_double=function(c,d){if(d==a){var e,f;return e=c[0].directed?"-[:NOLABEL]->":"-[:NOLABEL]-",f=c[1].directed?"<-[:NOLABEL]-":"-[:NOLABEL]-","(n"+c[0].source.id+")"+e+"(n"+c[0].target.id+")"+f+"(n"+c[1].source.id+")"}if(d==b){var e,f;return e=c[0].directed?"<-[:NOLABEL]-":"-[:NOLABEL]-",f=c[1].directed?"-[:NOLABEL]->":"-[:NOLABEL]-","(n"+c[0].target.id+")"+e+"(n"+c[0].source.id+")"+f+"(n"+c[1].target.id+")"}},this.search_tgraph=function(a){for(var b=0;b<e.links.length;b++){var c=e.links[b].id==a;if(c&&1!=e.links[b].flagged)return b}},this.prune_links=function(a){for(var b=[],c=0;c<a.length;c++)b.push(this.search_tgraph(a[c]));this.prune_tgraph(b)},this.combine_fragments=function(a){for(var b="MATCH ",c=a.length-1,d=0;c>d;d++)b+=a[d]+",";return b+=a[c]+" RETURN *"},this.get_related_links=function(c){var d=[],f=e.links.length;if(c.chain==a){for(var g=0;f>g;g++)if(!e.links[g].flagged){var h=e.links[g].target.id==c.node.node;h&&d.push(e.links[g])}}else if(c.chain==b)for(var g=0;g<e.links.length;g++)if(!e.links[g].flagged){var h=e.links[g].source.id==c.node.node;h&&d.push(e.links[g])}return d},this.worker_function=function(a){var b=this.generate_chains(a);if(b.incoming.length>0&&b.outgoing.length>0){var f=this.calculate_candidate(b);if(f.mode==d){if(this.generate_fragment(d,null),0==g){var h=this.find_isolated_nodes(e);this.generate_node_frags(h)}return}f.mode==c&&(f.param.related_links=this.get_related_links(f.param),this.generate_fragment(c,f),this.worker_function(e))}else{if(this.is_graph_flagged(a)){if(0==g){var h=this.find_isolated_nodes(e);this.generate_node_frags(h)}return}var h=this.find_isolated_nodes(e);this.generate_node_frags(h)}},this.sort_chain=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push([a[c].node,a[c].count]);return b.sort(function(a,b){return a[1]-b[1]}),b},this.sort_z=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push([a[c].node,a[c].count]);return b.sort(function(a,b){return a[0]-b[0]}),b},this.find_largest=function(a){for(var b=a[0],c=0;c<a.length;c++)a[c].count>b.count&&(b=a[c]);return b},this.calculate_candidate=function(e){var f=e.incoming,g=e.outgoing,h=this.find_largest(f),i=this.find_largest(g),j=i.count,k=h.count;if(k==j){if(1==k&&1==j)return{mode:d,param:null};var l=this.pick_random([{chain:a,node:h},{chain:b,node:i}]);return{mode:c,param:l}}if(h.count>i.count){var l={chain:a,node:h};return{mode:c,param:l}}if(h.count<i.count){var l={chain:b,node:i};return{mode:c,param:l}}},this.reverse_link=function(a){var b=a.source;return a.source=a.target,a.target=b,a},this.get_chance=function(){var a=Math.round(Math.random()%2);return 0==a?!1:!0},this.pick_random=function(a){var b=Math.round(Math.random()%2);return a[b]},this.generate_query=function(a){if(0==a.nodes.length)return void console.error("No Nodes in your Query");if(e=a,f=[],this.worker_function(e),f.length>0){var b=this.combine_fragments(f);return b}console.error("Internal Fragments returned empty")}}return a});